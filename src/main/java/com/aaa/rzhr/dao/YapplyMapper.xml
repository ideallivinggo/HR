<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--mapper路径-->
<mapper namespace="com.aaa.rzhr.dao.YapplyMapper">


    <!--查看职业-->
    <select id="queryAllPos" resultType="Position">
       select * from position
    </select>
    <!--查看部门-->
    <select id="queryAllDept" resultType="Dept">
        select * from dept
    </select>
    <!--查看员工申请人-->
    <select id="queryAllEmp" resultType="Emp">
        select * from emp e inner join dept d on e.deptid=d.deptid where e.deptid=1
    </select>
    <!--添加招聘申请-->
    <insert id="addRec" parameterType="Recruitment">
        INSERT  INTO recruitment(empid, deptid, recaddress, poid, recnumber, recreachdate, recsex,
                                  receducation, recage, recsuffer, recmajor, recrequire, recstate)
           values(#{empid}, #{deptid}, #{recaddress}, #{poid}, #{recnumber}, #{recreachdate}, #{recsex},
                  #{receducation}, #{recage}, #{recsuffer}, #{recmajor}, #{recrequire}, #{recstate} )
    </insert>
    <!--查看招聘信息-->
    <select id="queryAllRec" resultType="java.util.Map" parameterType="Map">
        SELECT * FROM  recruitment r
        LEFT JOIN emp e ON r.empid = e.empid
        LEFT JOIN dept d ON r.deptid = d.deptid
        LEFT JOIN position p ON r.poid = p.poid
        WHERE 1 = 1
            <if test="recid != null">
                AND recid = #{recid}
            </if>
            <if test="recstate != null">
                AND recstate = #{recstate}
            </if>

    </select>
    <!--修改招聘需求-->
    <update id="updateRec" parameterType="Recruitment">
        UPDATE recruitment SET
        <if test="recnumber != null"> recnumber=#{recnumber}, </if>
        <if test="recsex != null"> recsex=#{recsex}, </if>
        <if test="receducation != null"> receducation= #{receducation}, </if>
        <if test="recage != null"> recage=#{recage}, </if>
        <if test="recsuffer != null"> recsuffer=#{recsuffer}, </if>
        <if test="recmajor != null"> recmajor=#{recmajor},</if>
        <if test="recrequire != null">  recrequire=#{recrequire}, </if>
        <if test="recstate != null">  recstate=#{recstate} </if>
         WHERE recid=#{recid}
    </update>



    <!--添加简历-->
    <insert id="addResEntering" parameterType="Resume">
        INSERT INTO resume(resumename, sex, education, age, phone, resmajor, resposition, emali, resdate, resstate)
        VALUES (#{resumename}, #{sex}, #{education}, #{age}, #{phone}, #{resmajor}, #{resposition}, #{emali}, #{resdate}, #{resstate})
    </insert>
    <!--查看简历-->
    <select id="queryAllRes"  resultType="java.util.Map" parameterType="Map">
        select * from resume WHERE  1 = 1
        <choose>
            <when test="resid != null">
                AND resid = #{resid}
            </when>
            <otherwise>
                <if test="resstate != null">
                    AND resstate = #{resstate}
                </if>
                <if test="education != ''">
                    AND education = #{education}
                </if>
                <if test="sex != ''">
                    AND sex = #{sex}
                </if>
            </otherwise>
        </choose>
    </select>
    <!--简历筛选选中-->
    <update id="updateResOne" parameterType="Map">
        UPDATE resume set resstate = ${resstate}  WHERE resid in (${s})
    </update>





    <!--添加第一次面试-->
    <insert id="addIntone" parameterType="Interviewone">
        INSERT  INTO interviewone(resid, inograde, inodate, inonotes, inname, inostate)
        VALUES (#{resid}, #{inograde}, #{inodate}, #{inonotes}, #{inname}, #{inostate})
    </insert>
    <!--查看第一次面试-->
    <select id="queryAllInte" resultType="java.util.Map" parameterType="Map">
        SELECT r.*, i.inoid,i.inograde, i.inonotes, i.inname, i.inostate,
        str_to_date(inodate,'%Y-%m-%d') inodate FROM interviewone i
        INNER JOIN resume r ON i.resid = r.resid WHERE 1=1
        <choose>
            <when test="inoid != null">
                AND inoid = #{inoid}
            </when>
            <otherwise>
                <if test="inostate != null">
                    AND inostate = #{inostate}
                </if>
                ORDER BY inodate
            </otherwise>
        </choose>
    </select>
    <!--修改第一次面试-->
    <update id="updateInte" parameterType="Interviewone">
         UPDATE interviewone SET
        <if test="inograde != null">
            inograde=#{inograde},
        </if>
        <if test="inname != null">
            inname=#{inname},
        </if>
        <if test="inonotes != null">
            inonotes=#{inonotes},
        </if>
        <if test="inostate != null">
            inostate=#{inostate}
        </if>
         WHERE inoid=#{inoid}
    </update>




    <!--添加第二次面试-->
    <insert id="addIntTwo" parameterType="Interviewtwo">
        INSERT INTO interviewtwo(resid, intgrade, intdate, intnotes, intname, intstate)
        VALUES (#{resid}, #{intgrade}, #{intdate}, #{intnotes}, #{intname}, #{intstate})
    </insert>
    <!--查看第二次面试-->
    <select id="queryAllInteTwo" resultType="java.util.Map" parameterType="Map">
        SELECT r.*, i.intid, i.intgrade, i.intnotes, i.intname, i.intstate,
        str_to_date(intdate,'%Y-%m-%d') intdate FROM interviewtwo i
        INNER JOIN resume r ON i.resid = r.resid WHERE 1=1
        <choose>
            <when test="intid != null">
                AND intid = #{intid}
            </when>
            <otherwise>
                <if test="intstate != null">
                    AND intstate = #{intstate}
                </if>
                ORDER BY intdate
            </otherwise>
        </choose>
    </select>
    <!--修改第二次面试-->
    <update id="updateInteTwo" parameterType="Interviewtwo">
        UPDATE interviewtwo SET
        <if test="intgrade != null">
            intgrade=#{intgrade},
        </if>
        <if test="intname != null">
            intname=#{intname},
        </if>
        <if test="intnotes != null">
            intnotes=#{intnotes},
        </if>
        <if test="intstate != null">
            intstate=#{intstate}
        </if>
        WHERE intid=#{intid}
    </update>



    <!--面试完成推送-->
    <update id="inteTwoPash" parameterType="Map">
        UPDATE interviewtwo set intstate = ${intstate}  WHERE intid in (${s})
    </update>
    <!--添加员工到待入职状态-->
    <select id="addEmp" parameterType="Emp">
        INSERT INTO emp (empnumber, empname, mppicture, typeid, idnumber, sex, birthdate, nation,
        accounttype, eduid, address, politics, qqnumber, phone, password, salt, email, urgencyphone,
        urgencyname, empnotes, deptid, poid, emptypeid, emppay, empstateid, empstatedate)
        VALUES (#{empnumber}, #{empname}, #{mppicture}, #{typeid}, #{idnumber}, #{sex}, #{birthdate},
        #{nation}, #{accounttype}, #{eduid}, #{address}, #{politics}, #{qqnumber}, #{phone},
        #{password}, #{salt}, #{email}, #{urgencyphone}, #{urgencyname}, #{empnotes}, #{deptid}, #{poid},
        #{emptypeid}, #{emppay}, #{empstateid}, #{empstatedate})
    </select>

    <!--获取最大的员工激活编号-->
    <select id="queryActID" parameterType="int" resultType="java.util.Map">
        SELECT actid FROM activation WHERE actid=(SELECT MAX(actid) FROM activation)
    </select>

    <!--录取后添加到员工激活表-->
    <insert id="addAct" parameterType="Activation">
        INSERT  INTO activation(resid, actnumber, actpwd, actdate, actstate)
        VALUES (#{resid}, #{actnumber}, #{actpwd}, #{actdate}, #{actstate})
    </insert>









    <!--统计员工类型-->
    <select id="countEmpState" resultType="java.util.Map">
        SELECT COUNT(empstateid) AS countstate FROM emp GROUP BY empstateid
    </select>

    <!--合同到期提醒小于或者等于当前日期-->
    <select id="countContract" resultType="java.util.Map">
        SELECT COUNT(conid) AS countnum FROM contract
        where conover &lt;= (select current_date as Systemtime)
    </select>

    <!--加班审批-->
    <select id="countOvertime" resultType="java.util.Map">
        SELECT COUNT(apovstate) AS countnum FROM apply_overtime where apovstate = 0
    </select>

    <!--离职审批-->
    <select id="countDimission" resultType="java.util.Map">
        SELECT COUNT(dimstate) AS countnum FROM apply_dimission where dimstate = 0
    </select>

    <!--休假审批-->
    <select id="countLeave" resultType="java.util.Map">
        SELECT COUNT(leasate) AS countnum FROM apply_leave where leasate = 0
    </select>


</mapper>