<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aaa.rzhr.dao.UserDao">
    <!--个人信息的查询 -->
    <select id="L_query_user" resultType="java.util.Map">
     select * from emp e
left join id_type idtype on e.typeid = idtype.typeid
left join dept d on e.deptid = d.deptid
left join recruitment r on r.empid=e.empid
left join position p on p.posid=e.poid WHERE e.empid=#{empid}
    </select>
<!--请假的添加-->
    <insert id="L_add_leave"  parameterType="java.util.Map">
        insert into apply_leave(empid,leaoverdate,leaday,leatype,leareason,leaenterdate,shendate,leasate) values(#{0},#{1},#{2},#{3},#{4},#{5},#{6},#{7})
    </insert>

<!--修改登录密码-->
    <update id="L_update_pwd"  parameterType="Emp">
        update emp set empname='13' WHERE empnumber='12'
    </update>
    <!--查询每个审核状态-->
    <select id="L_query_leave" resultType="java.util.Map" parameterType="Map">
        SELECT
        *
        FROM
        apply_leave al
        LEFT JOIN emp e ON e.empid = al.empid
        WHERE
        e.empid = #{empid}
    </select>
    <!--历史工资单查询-->
    <select  id="L_query_pay" resultType="java.util.Map" parameterType="Int">
        SELECT * from emp e
left join payroll p on e.empid = p.empid
left join att_statisticsxq ast on e.empid = ast.empid
left join att_statistics asts on asts.staid= ast.staid
WHERE  e.empid=#{empid}
    </select>

    <!--加班的添加-->
    <insert id="L_add_jiaban"  parameterType="java.util.Map">
        insert into apply_overtime(empid,apovtype,apovstartdate,apoverdate,apovhour,apovreason,apovstate) values(#{0},#{1},#{2},#{3},#{4},#{5},#{6})
    </insert>
    <!--离职申请-->
    <insert id="L_add_lizhi"  parameterType="java.util.Map">
        insert into apply_dimission(empid,dimtype,dimdetails,dimsuggest,dimturn,dimapplydate,dimstate) values(#{0},#{1},#{2},#{3},#{4},#{5},#{6})
    </insert>
    <!--休假查询-->
    <select id="L_query_xiujia" resultType="java.util.Map" parameterType="Map">
        SELECT
        *
        FROM
        apply_leave al
        LEFT JOIN emp e ON e.empid = al.empid
        WHERE
        e.empid = #{empid}
        <if test="fristdate!=''">
         and   al.shendate  &gt;= #{fristdate}
        </if>
        <if test="overdate!=''">
        and  al.shendate &lt;= #{overdate}
        </if>
        <if test="leasate!=null">
            AND  al.leasate=#{leasate}
        </if>
    </select>
    <!--加班查询-->
    <select id="L_query_jiaban" resultType="java.util.Map" parameterType="Map">
        SELECT
        *
        FROM
        apply_overtime ao
        LEFT JOIN emp e ON e.empid = ao.empid
        WHERE
        e.empid = #{empid}
        <if test="fristdate!=''">
            and   ao.shentime  &gt;= #{fristdate}
        </if>
        <if test="overdate!=''">
            and  ao.shentime &lt;= #{overdate}
        </if>
        <if test="apovstate!=null">
            AND  ao.apovstate=#{apovstate}
        </if>
    </select>
    <!--离职查询-->
    <select id="L_query_cizhi" resultType="java.util.Map" parameterType="Map">
        SELECT
        *
        FROM
        apply_dimission ad
        LEFT JOIN emp e ON e.empid = ad.empid
        WHERE
        e.empid = #{empid}
        <if test="fristdate!=''">
            and   ad.shendimdate  &gt;= #{fristdate}
        </if>
        <if test="overdate!=''">
            and   ad.shendimdate &lt;= #{overdate}
        </if>
        <if test="dimstate!=null">
            AND  ad.dimstate=#{dimstate}
        </if>
    </select>
    <!--修改休假状态-->
    <update id="L_update_xiujia"  parameterType="Integer">
       UPDATE  apply_leave  SET leasate=3
       where leaid=#{leaid}
    </update>
    <!--修改加班状态-->
    <update id="L_update_jiaban"  parameterType="Integer">
        UPDATE  apply_overtime  SET apovstate=3
        where apovid=#{apovid}
    </update>
    <!--修改离职状态-->
    <update id="L_update_cizhi"  parameterType="Integer">
        UPDATE  apply_dimission  SET dimstate=3
        where dimid=#{dimid}
    </update>
    </mapper>